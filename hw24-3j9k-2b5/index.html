<!-- UPDATE CHECKPOINT: v2.0 - Halloween Card - Fully Dynamic Text & Auto-scaling -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="robots" content="noindex, nofollow">
    <meta property="og:title" content="Happy Halloween! ðŸŽƒ">
    <meta property="og:description" content="Click to view your personalized spooky message.">
    <meta property="og:type" content="website">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta id="theme-color-meta" name="theme-color" content="#1a0b2e" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiSGFsbG93ZWVuIENhcmQiLCJzaG9ydF9uYW1lIjoiU3Bvb2t5Iiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwib3JpZW50YXRpb24iOiJwb3J0cmFpdCIsInRoZW1lX2NvbG9yIjoiIzFhMGIyZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWEwYjJlIn0=" />
    <title>Happy Halloween</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
      :root { --color-bg-dark: #0d0417; --color-bg-light: #2e1a47; --color-text-start: #ff9a00; --color-text-end: #ff5e00; }
      html { background-color: var(--color-bg-dark); height: 100%; transition: background-color 0.5s ease; }
      body { margin: 0; padding: 0; width: 100%; height: 100dvh; background: radial-gradient(circle at center, var(--color-bg-light) 0%, var(--color-bg-dark) 100%); font-family: 'Dancing Script', cursive; overflow: hidden; -webkit-font-smoothing: antialiased; position: fixed; left: 0; top: 0; right: 0; bottom: 0; }
      .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 10; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); box-sizing: border-box; }
      .card-content { position: relative; width: 100%; height: 100%; max-width: 450px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; box-sizing: border-box; }
      .text-section { text-align: center; width: 100%; margin-top: 40px; margin-bottom: 2vh; z-index: 20; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 150px; }
      .dynamic-message { font-family: 'Dancing Script', cursive; color: var(--color-text-start); font-weight: 700; background: linear-gradient(to right, #ff9a00, #ffc800, #ff5e00, #ffc800, #ff9a00); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 5s linear infinite; line-height: 1.2; padding: 0 0.5rem; display: block; filter: drop-shadow(0 2px 8px rgba(255, 100, 0, 0.4)); word-wrap: break-word; overflow-wrap: break-word; text-align: center; width: 100%; }
      @keyframes shine { to { background-position: 200% center; } }
      .image-container { width: 100%; flex: 1; display: flex; align-items: center; justify-content: center; position: relative; z-index: 10; overflow: hidden; margin-bottom: 2vh; max-height: 55vh; }
      .main-image { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }
      .fallback-icon { display: none; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; animation: float 3s infinite; }
      .fallback-icon svg { fill: #ff9a00; filter: drop-shadow(0 0 15px rgba(255, 154, 0, 0.6)); }
      @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
      .bats-container { position: absolute; inset: 0; pointer-events: none; overflow: hidden; z-index: 1; }
      .bat { position: absolute; opacity: 0.7; width: 50px; left: -300px; }
      @keyframes flyRight { 0% { left: -150px; transform: translateY(0) rotate(10deg); } 100% { left: 110%; transform: translateY(0) rotate(10deg); } }
      @keyframes flyLeft { 0% { left: 110%; transform: translateY(0) rotate(-10deg) scaleX(-1); } 100% { left: -150px; transform: translateY(0) rotate(-10deg) scaleX(-1); } }
      #rotate-overlay { display: none; position: fixed; inset: 0; background-color: var(--color-bg-dark); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; color: var(--color-text-start); text-align: center; }
      #rotate-overlay svg { width: 80px; height: 80px; fill: var(--color-text-start); margin-bottom: 20px; animation: rotate-phone 2s infinite ease-in-out; }
      @keyframes rotate-phone { 0%, 10% { transform: rotate(90deg); } 50%, 60% { transform: rotate(0deg); } 100% { transform: rotate(90deg); } }
      @media screen and (max-height: 550px) and (orientation: landscape) { #rotate-overlay { display: flex; } .app-container { visibility: hidden; } }
    </style>
  </head>
  <body>
    <div id="rotate-overlay"><svg viewBox="0 0 24 24"><path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></svg><h2>Please Rotate Your Device</h2></div>
    <div id="bats-container" class="bats-container"></div>
    <div class="app-container">
      <div class="card-content">
        <div class="text-section"><h1 id="dynamic-message" class="dynamic-message"></h1></div>
        <div class="image-container">
           <div id="fallback-icon" class="fallback-icon"><svg viewBox="0 0 24 24" width="150" height="150"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 2.07c3.07.38 5.57 2.52 6.54 5.36L13 9.5V4.07zM4.26 14C4.1 13.36 4 12.69 4 12c0-1.85.66-3.55 1.76-4.9l5.24 5.24V19c-3.72-1.21-6.42-4.52-6.74-8.5v3.5zM12 19v-6.66l5.34-5.34C18.23 8.32 19 9.99 19 12c0 4.42-3.58 8-8 8v-1z"/><path d="M7 12c0 2.5 2 4.5 5 4.5s5-2 5-4.5-2-1.5-5-1.5-5 1.5-5 1.5z"/></svg></div>
           <img id="main-image" src="../images/halloween_gorseli.png" alt="Halloween Card" class="main-image" onerror="this.style.display='none'; document.getElementById('fallback-icon').style.display='flex';"/>
        </div>
      </div>
    </div>
    <script>
      function fitDynamicText(el, maxLines = 3) {
        const isMobile = window.innerWidth <= 600;
        let fontSize = isMobile ? 51 : 67; 
        el.style.fontSize = fontSize + 'px';
        el.style.whiteSpace = 'normal';
        function isOverLimit() {
          const style = window.getComputedStyle(el);
          const lineHeight = parseFloat(style.lineHeight);
          const height = el.getBoundingClientRect().height;
          const limit = lineHeight * maxLines + 2;
          return height > limit;
        }
        while (isOverLimit() && fontSize > 10) { fontSize -= 1; el.style.fontSize = fontSize + 'px'; }
      }
      document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        const msgElement = document.getElementById('dynamic-message');
        const encodedData = params.get('msg') || params.get('ad');
        let textContent = "Happy Halloween";
        if (encodedData) {
          try { textContent = decodeURIComponent(escape(window.atob(encodedData))); } 
          catch (e) { try { textContent = atob(encodedData); } catch (err) {} }
        }
        msgElement.textContent = textContent;
        requestAnimationFrame(() => fitDynamicText(msgElement));
        window.addEventListener('resize', () => fitDynamicText(msgElement));
        const batsContainer = document.getElementById('bats-container');
        function spawnBat(initial = false) {
            const bat = document.createElement('img');
            bat.src = '../images/yarasa_gorseli.png'; 
            bat.className = 'bat';
            const isFlyingRight = Math.random() > 0.5;
            bat.style.cssText = `top:${Math.random()*80}%;width:${40+Math.random()*60}px;animation:${isFlyingRight?'flyRight':'flyLeft'} ${5+Math.random()*5}s linear ${initial?Math.random()*5:0}s;`;
            bat.addEventListener('animationend', () => { bat.remove(); spawnBat(); });
            batsContainer.appendChild(bat);
        }
        for (let i = 0; i < 8; i++) spawnBat(true);
      });
    </script>
  </body>
</html>